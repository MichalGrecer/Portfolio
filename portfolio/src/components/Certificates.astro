---
const certificates = [
  {
    name: "MTCNA – MikroTik Certified Network Associate",
    issuer: "MikroTik",
    date: "2025",
    link: "/MTCNA.pdf",
    type: "pdf",
    // Nowe pole z opisem
    description: "Potwierdzenie umiejętności zarządzania systemem RouterOS, w tym: konfiguracja routingu, firewall, QoS, bridging, sieci bezprzewodowe oraz tunele VPN."
  }
];
---

<section class="opacity-0 translate-y-4 transition-all duration-700 ease-out section-animate mb-32">
  <div class="flex items-center gap-3 mb-12">
    <div class="h-px bg-zinc-200 dark:bg-zinc-800 flex-grow"></div>
    <h2 class="text-xs font-bold text-zinc-400 dark:text-zinc-500 uppercase tracking-[0.2em]">
      Certyfikaty
    </h2>
    <div class="h-px bg-zinc-200 dark:bg-zinc-800 flex-grow"></div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    {certificates.map((cert) => (
      <button 
        data-pdf={cert.link}
        class="cert-trigger group w-full text-left flex items-start gap-5 p-6 rounded-2xl border border-zinc-200 dark:border-zinc-900 bg-white/50 dark:bg-zinc-900/20 transition-all hover:border-blue-500/30 hover:bg-white dark:hover:bg-zinc-900 cursor-pointer focus:outline-none"
      >
        <div class="flex-shrink-0 w-10 h-10 rounded-full bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center text-blue-500 group-hover:scale-110 transition-transform mt-1">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 15c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3Z"/><path d="M8.5 2h7"/><path d="M5 8v14l7-4 7 4V8"/><path d="M5 8a5 5 0 0 1 5-5h4a5 5 0 0 1 5 5"/></svg>
        </div>

        <div class="flex-grow">
          <h3 class="font-bold text-zinc-900 dark:text-zinc-100 group-hover:text-blue-500 transition-colors text-lg">
            {cert.name}
          </h3>
          
          {cert.description && (
            <p class="text-sm text-zinc-500 dark:text-zinc-400 mt-2 mb-4 leading-relaxed">
              {cert.description}
            </p>
          )}

          <div class="flex justify-between items-center mt-auto pt-2 border-t border-zinc-100 dark:border-zinc-800/50">
            <span class="text-xs font-bold text-zinc-400 uppercase tracking-wider">{cert.issuer}</span>
            <span class="text-xs font-mono text-zinc-400 border border-zinc-200 dark:border-zinc-800 px-2 py-0.5 rounded">
              {cert.date}
            </span>
          </div>
        </div>
      </button>
    ))}
  </div>
</section>

<dialog id="cert-modal" class="bg-white dark:bg-[#0a0a0a] w-full max-w-5xl h-[85vh] rounded-2xl p-0 shadow-2xl m-auto border border-zinc-200 dark:border-zinc-800 backdrop:bg-black/60 backdrop:backdrop-blur-sm outline-none">
    <div class="flex justify-between items-center p-4 border-b border-zinc-100 dark:border-zinc-800 bg-white dark:bg-[#0a0a0a]">
        <h3 class="text-sm font-bold text-zinc-500 uppercase tracking-widest ml-2">Podgląd Certyfikatu</h3>
        <button id="close-cert-modal" class="p-2 rounded-full bg-zinc-100 dark:bg-zinc-800 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
    </div>
    <div class="w-full h-[calc(100%-60px)] bg-zinc-100 dark:bg-zinc-900">
        <iframe id="cert-iframe" src="" class="w-full h-full border-none"></iframe>
    </div>
</dialog>

<script>
    const certModal = document.getElementById('cert-modal');
    const certIframe = document.getElementById('cert-iframe');
    const closeCertBtn = document.getElementById('close-cert-modal');
    const certTriggers = document.querySelectorAll('.cert-trigger');

    certTriggers.forEach(trigger => {
        trigger.addEventListener('click', () => {
            const pdfPath = trigger.getAttribute('data-pdf');
            if (pdfPath) {
                // Rzutowanie na HTMLIFrameElement i HTMLDialogElement dla TypeScripta (jeśli używasz strict mode)
                (certIframe as HTMLIFrameElement).src = pdfPath;
                (certModal as HTMLDialogElement).showModal();
            }
        });
    });

    const closeCertModal = () => {
        (certModal as HTMLDialogElement).close();
        setTimeout(() => { (certIframe as HTMLIFrameElement).src = ''; }, 300);
    };

    closeCertBtn?.addEventListener('click', closeCertModal);

    certModal?.addEventListener('click', (event) => {
        const rect = certModal.getBoundingClientRect();
        const isInDialog = (rect.top <= event.clientY && event.clientY <= rect.top + rect.height &&
          rect.left <= event.clientX && event.clientX <= rect.left + rect.width);
        if (!isInDialog) {
            closeCertModal();
        }
    });
</script>

<style>
    dialog[open] {
        animation: zoom-in 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    @keyframes zoom-in {
        from { transform: scale(0.95); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
    }
    body:has(dialog[open]) {
        overflow: hidden;
    }
</style>